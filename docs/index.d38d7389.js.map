{"mappings":"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","sources":["src/index.ts"],"sourcesContent":["function toRadians(degrees: number) {\r\n  return (degrees * Math.PI) / 180;\r\n}\r\n\r\ntype Entity = {\r\n  id: string;\r\n  stale: boolean;\r\n  render(ctx: CanvasRenderingContext2D): void;\r\n  update(isPressed: (key: Key) => boolean): void;\r\n};\r\n\r\ntype Collides = Physical & {\r\n  bbox: {\r\n    width: number;\r\n    height: number;\r\n  };\r\n  onCollisionWith(entity: Entity): void;\r\n};\r\n\r\nfunction collidesWith(rect1: Collides, rect2: Collides): boolean {\r\n  return (\r\n    rect1.x - rect1.bbox.width / 2 < rect2.x - rect2.bbox.width / 2 + rect2.bbox.width &&\r\n    rect1.x - rect1.bbox.width / 2 + rect1.bbox.width > rect2.x + rect2.bbox.width &&\r\n    rect1.y - rect1.bbox.height / 2 < rect2.y - rect2.bbox.height / 2 + rect2.bbox.height &&\r\n    rect1.bbox.height + rect1.y - rect1.bbox.height / 2 > rect2.y - rect2.bbox.height / 2\r\n  );\r\n}\r\n\r\ntype Physical = {\r\n  x: number;\r\n  y: number;\r\n  vx: number;\r\n  vy: number;\r\n};\r\n\r\ntype Bounded = {\r\n  width: number;\r\n  height: number;\r\n};\r\n\r\nfunction physicalUpdate(physical: Physical) {\r\n  physical.x += physical.vx;\r\n  physical.y += physical.vy;\r\n}\r\n\r\ntype Asteroid = Physical & Bounded;\r\ntype Bullet = Physical;\r\n\r\nfunction asteroidEntity(\r\n  asteroid: Asteroid,\r\n  onSpawnAsteroid: (asteroid: Asteroid) => void\r\n): Entity & Asteroid & Collides {\r\n  return {\r\n    id: \"asteroid\",\r\n    stale: false,\r\n    bbox: {\r\n      width: asteroid.width,\r\n      height: asteroid.height,\r\n    },\r\n    ...asteroid,\r\n    render(ctx: CanvasRenderingContext2D) {\r\n      ctx.strokeStyle = \"white\";\r\n      ctx.strokeRect(this.x - this.width / 2, this.y - this.height / 2, this.width, this.height);\r\n    },\r\n    update(_isPressed) {\r\n      if (this.height * this.width < 400) {\r\n        this.stale = true;\r\n      }\r\n      physicalUpdate(this);\r\n    },\r\n    onCollisionWith(entity) {\r\n      if (entity.id === \"bullet\") {\r\n        const dx = this.vx;\r\n        const dy = this.vy;\r\n\r\n        const asteroidLeft: Asteroid = {\r\n          ...this,\r\n          width: this.height / Math.sqrt(2),\r\n          height: this.width / Math.sqrt(2),\r\n          vx: dx,\r\n          vy: -dy,\r\n        };\r\n        const asteroidRight: Asteroid = {\r\n          ...this,\r\n          width: this.width / Math.sqrt(2),\r\n          height: this.height / Math.sqrt(2),\r\n          vx: -dx,\r\n          vy: dy,\r\n        };\r\n        this.stale = true;\r\n        onSpawnAsteroid(asteroidLeft);\r\n        onSpawnAsteroid(asteroidRight);\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nfunction bulletEntity(bullet: Bullet): Entity & Bullet & Collides {\r\n  const spawnTime = Date.now();\r\n  return {\r\n    id: \"bullet\",\r\n    stale: false,\r\n    ...bullet,\r\n    bbox: {\r\n      height: 3,\r\n      width: 3,\r\n    },\r\n    render(ctx: CanvasRenderingContext2D) {\r\n      ctx.fillStyle = \"white\";\r\n      ctx.fillRect(this.x - 1, this.y - 1, 3, 3);\r\n    },\r\n    update(isPressed) {\r\n      physicalUpdate(this);\r\n      if (Date.now() - spawnTime > 1000) {\r\n        this.stale = true;\r\n      }\r\n    },\r\n    onCollisionWith(entity) {\r\n      if (entity.id === \"asteroid\") {\r\n        this.stale = true;\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\ntype Ship = Physical & {\r\n  speed: number;\r\n  theta: number;\r\n  friction: number;\r\n};\r\n\r\nfunction shipEntity(ship: Ship, onCreateBullet: (bullet: Bullet) => void): Entity & Ship & Collides {\r\n  return {\r\n    id: \"ship\",\r\n    stale: false,\r\n    ...ship,\r\n    bbox: {\r\n      width: 30,\r\n      height: 35,\r\n    },\r\n    render(ctx) {\r\n      drawTriangle(ctx, \"white\", this.x, this.y, 30, 35, this.theta);\r\n    },\r\n    update(isPressed) {\r\n      const cosine = Math.cos(toRadians(this.theta - 90));\r\n      const sine = Math.sin(toRadians(this.theta - 90));\r\n      if (isPressed(Key.LEFT)) {\r\n        this.theta = (this.theta - 5) % 360;\r\n      }\r\n      if (isPressed(Key.RIGHT)) {\r\n        this.theta = (this.theta + 5) % 360;\r\n      }\r\n      if (isPressed(Key.UP)) {\r\n        this.vx += cosine * this.speed;\r\n        this.vy += sine * this.speed;\r\n      }\r\n      if (isPressed(Key.DOWN)) {\r\n        this.vx -= cosine * this.speed;\r\n        this.vy -= sine * this.speed;\r\n      }\r\n\r\n      this.vx *= 1 - this.friction;\r\n      this.vy *= 1 - this.friction;\r\n      if (isPressed(Key.SPACE)) {\r\n        onCreateBullet({\r\n          x: this.x + (cosine * 30) / 2,\r\n          y: this.y + (sine * 35) / 2,\r\n          vx: this.vx + cosine * 10,\r\n          vy: this.vy + sine * 10,\r\n        });\r\n      }\r\n\r\n      physicalUpdate(this);\r\n    },\r\n    onCollisionWith(other) {},\r\n  };\r\n}\r\n\r\nenum Key {\r\n  LEFT = 0,\r\n  RIGHT,\r\n  UP,\r\n  DOWN,\r\n  SPACE,\r\n}\r\n\r\ntype KeyStates = { [key: string]: boolean };\r\n\r\ntype ControlScheme = (keyStates: KeyStates, key: Key) => boolean;\r\n\r\nfunction isPressed(keyStates: KeyStates, key: string) {\r\n  return keyStates[key] ?? false;\r\n}\r\n\r\nconst basicControlScheme: ControlScheme = (keyStates, key) => {\r\n  if (key === Key.LEFT) {\r\n    return isPressed(keyStates, \"a\") || isPressed(keyStates, \"ArrowLeft\");\r\n  }\r\n  if (key === Key.RIGHT) {\r\n    return isPressed(keyStates, \"d\") || isPressed(keyStates, \"ArrowRight\");\r\n  }\r\n  if (key === Key.DOWN) {\r\n    return isPressed(keyStates, \"s\") || isPressed(keyStates, \"ArrowDown\");\r\n  }\r\n  if (key === Key.UP) {\r\n    return isPressed(keyStates, \"w\") || isPressed(keyStates, \"ArrowUp\");\r\n  }\r\n  if (key === Key.SPACE) {\r\n    return isPressed(keyStates, \"Spacebar\") || isPressed(keyStates, \" \");\r\n  }\r\n  return false;\r\n};\r\n\r\nfunction onKeyStateChange(keyStates: KeyStates, onEventValue: boolean) {\r\n  return (e: KeyboardEvent) => {\r\n    keyStates[e.key] = onEventValue;\r\n  };\r\n}\r\n\r\nfunction loop(timeStepMs: number, update: () => boolean) {\r\n  const i = setInterval(() => {\r\n    if (update()) {\r\n      clearInterval(i);\r\n    }\r\n  }, timeStepMs);\r\n\r\n  return i;\r\n}\r\n\r\nfunction withContext(context: CanvasRenderingContext2D, fn: (ctx: CanvasRenderingContext2D) => void) {\r\n  const oldStyle = context.fillStyle;\r\n  const oldStroke = context.strokeStyle;\r\n  fn(context);\r\n  context.fillStyle = oldStyle;\r\n  context.strokeStyle = oldStroke;\r\n}\r\n\r\nfunction drawTriangle(\r\n  context: CanvasRenderingContext2D,\r\n  style: string,\r\n  x: number,\r\n  y: number,\r\n  base: number,\r\n  height: number,\r\n  rotation: number\r\n) {\r\n  const angle = (rotation * Math.PI) / 180;\r\n  context.translate(x, y);\r\n  context.rotate(angle);\r\n\r\n  withContext(context, () => {\r\n    context.strokeStyle = style;\r\n    context.fillStyle = \"red\";\r\n    context.beginPath();\r\n    context.moveTo(-base / 2, height / 2);\r\n    context.lineTo(0, -height / 2);\r\n    context.lineTo(0 + base / 2 + 1, height / 2);\r\n    context.lineTo(-base / 2, height / 2);\r\n    context.stroke();\r\n  });\r\n\r\n  context.rotate(-angle);\r\n  context.translate(-x, -y);\r\n}\r\n\r\nfunction clear(canvas: HTMLCanvasElement, context: CanvasRenderingContext2D) {\r\n  withContext(context, (context) => {\r\n    context.fillStyle = \"black\";\r\n    context.fillRect(0, 0, canvas.width, canvas.height);\r\n  });\r\n}\r\n\r\nfunction game(controlScheme: ControlScheme) {\r\n  const canvas = document.getElementById(\"asteroids-canvas\") as HTMLCanvasElement | null;\r\n  if (canvas === null) {\r\n    return;\r\n  }\r\n\r\n  const ctx = canvas.getContext(\"2d\");\r\n\r\n  if (ctx === null) {\r\n    return;\r\n  }\r\n\r\n  const keyStates: KeyStates = {};\r\n\r\n  document.onkeydown = onKeyStateChange(keyStates, true);\r\n  document.onkeyup = onKeyStateChange(keyStates, false);\r\n\r\n  const physicsManager = {\r\n    entities: [] as (Entity & Physical & Collides)[],\r\n    nextEntities: [] as (Entity & Physical & Collides)[],\r\n    add(entity: Entity & Physical & Collides) {\r\n      this.nextEntities.push(entity);\r\n    },\r\n    update() {\r\n      for (let entity = 0; entity < this.entities.length; ++entity) {\r\n        for (let otherEntity = 0; otherEntity < this.entities.length; ++otherEntity) {\r\n          if (otherEntity === entity) {\r\n            continue;\r\n          }\r\n          if (\r\n            !this.entities[entity].stale &&\r\n            !this.entities[otherEntity].stale &&\r\n            collidesWith(this.entities[entity], this.entities[otherEntity])\r\n          ) {\r\n            this.entities[entity].onCollisionWith(this.entities[otherEntity]);\r\n            this.entities[otherEntity].onCollisionWith(this.entities[entity]);\r\n          }\r\n        }\r\n        if (!this.entities[entity].stale) {\r\n          this.nextEntities.push(this.entities[entity]);\r\n        }\r\n      }\r\n      this.entities = this.nextEntities;\r\n      this.nextEntities = [];\r\n    },\r\n  };\r\n\r\n  const entityManager = {\r\n    entities: [] as (Entity & Physical)[],\r\n    nextEntities: [] as (Entity & Physical)[],\r\n    render(ctx: CanvasRenderingContext2D) {\r\n      for (const entity of this.entities) {\r\n        withContext(ctx, (ctx) => entity.render(ctx));\r\n      }\r\n    },\r\n    update(isPressed: (key: Key) => boolean) {\r\n      for (const entity of this.entities) {\r\n        entity.update(isPressed);\r\n        entity.x = (entity.x + 600) % 600;\r\n        entity.y = (entity.y + 600) % 600;\r\n        if (!entity.stale) {\r\n          this.nextEntities.push(entity);\r\n        }\r\n      }\r\n\r\n      this.entities = this.nextEntities;\r\n      this.nextEntities = [];\r\n    },\r\n    spawn(entity: Entity & Physical) {\r\n      this.nextEntities.push(entity);\r\n    },\r\n  };\r\n\r\n  const gun = {\r\n    lastTime: 0,\r\n    fire(bullet: Bullet) {\r\n      const currentTime = Date.now();\r\n      if (currentTime - this.lastTime > 300) {\r\n        createPhysical(bulletEntity(bullet));\r\n        this.lastTime = currentTime;\r\n      }\r\n    },\r\n  };\r\n\r\n  const createPhysical = (e: Entity & Physical & Collides) => {\r\n    entityManager.spawn(e);\r\n    physicsManager.add(e);\r\n  };\r\n\r\n  createPhysical(\r\n    shipEntity({ x: 300, y: 300, vx: 0, vy: 0, speed: 0.3, theta: 0, friction: 0.02 }, (bullet) => gun.fire(bullet))\r\n  );\r\n\r\n  const spawnAsteroid = (asteroid: Asteroid) => {\r\n    createPhysical(asteroidEntity(asteroid, spawnAsteroid));\r\n  };\r\n\r\n  for (let i = 0; i < 5; ++i) {\r\n    spawnAsteroid({\r\n      x: Math.random() * 600,\r\n      y: Math.random() * 600,\r\n      vx: Math.random() * 4 - 2,\r\n      vy: Math.random() * 4 - 2,\r\n      width: Math.random() * 40 + 35,\r\n      height: Math.random() * 40 + 35,\r\n    });\r\n  }\r\n\r\n  loop(20, () => {\r\n    clear(canvas, ctx);\r\n    entityManager.render(ctx);\r\n    physicsManager.update();\r\n    entityManager.update((key) => controlScheme(keyStates, key));\r\n    return false;\r\n  });\r\n}\r\n\r\ngame(basicControlScheme);\r\n"],"names":["toRadians","degrees","Math","PI","collidesWith","rect1","rect2","x","bbox","width","y","height","physicalUpdate","physical","vx","vy","asteroidEntity","asteroid","onSpawnAsteroid","id","stale","render","ctx","strokeStyle","strokeRect","this","update","_isPressed","onCollisionWith","entity","dx","dy","asteroidLeft","sqrt","asteroidRight","bulletEntity","bullet","spawnTime","Date","now","fillStyle","fillRect","isPressed","shipEntity","ship","onCreateBullet","drawTriangle","theta","cosine","cos","sine","sin","Key1","LEFT","RIGHT","UP","speed","DOWN","friction","SPACE","other","isPressed1","keyStates","key","Key","basicControlScheme","onKeyStateChange","onEventValue","e","loop","timeStepMs","i","setInterval","clearInterval","withContext","context","fn","oldStyle","oldStroke","style","base","rotation","angle","translate","rotate","beginPath","moveTo","lineTo","stroke","clear","canvas","context1","game","controlScheme","document","getElementById","ctx1","getContext","onkeydown","onkeyup","physicsManager","entities","nextEntities","add","push","length","otherEntity","entityManager","ctx2","spawn","gun","lastTime","fire","currentTime","createPhysical","spawnAsteroid","random"],"version":3,"file":"index.d38d7389.js.map"}